<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>The FI Calculator</title>
    
        <meta name="description" content="Plan your journey to Financial Independence and stress-test your portfolio with historical data and Monte Carlo simulations.">
        <meta property="og:title" content="The FI Calculator">
        <meta property="og:description" content="Plan your journey to Financial Independence and stress-test your portfolio with historical data and Monte Carlo simulations.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://theficalculator.com">
        <meta property="og:image" content="https://theficalculator.com/social-preview-image.png">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="The FI Calculator">
        <meta name="twitter:description" content="Plan your journey to Financial Independence and stress-test your portfolio with historical data and Monte Carlo simulations.">
        <meta name="twitter:image" content="https://theficalculator.com/social-preview-image.png">
    
        <link rel="icon" type="image/png" href="/favicon.png">
    
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <link rel="stylesheet" href="style.css">
    
        <script src="script.js" defer></script>
    </head>
<body class="bg-gray-100 min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="container mx-auto max-w-5xl bg-white p-6 sm:p-8 rounded-xl shadow-lg print-container">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-700">The FI Calculator</h1>
            <p class="text-gray-600 mt-2">Plan your journey to Financial Independence and stress-test your portfolio against market volatility.</p>
            <p class="text-sm text-gray-500 mt-2 max-w-3xl mx-auto">Financial Independence, Retire Early (FIRE) is a movement dedicated to achieving financial freedom long before traditional retirement age. This calculator helps you map out your journey.</p>
        </header>

        <div id="errorMessage" class="hidden error-message non-printable"></div>

        <div class="non-printable">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                <div>
             <h2 class="text-2xl font-semibold text-gray-800 mb-2">1. Your Financial Snapshot & Goals</h2>
             <p class="section-explanation">
                Start by entering your current financial details and your desired retirement lifestyle. This information is used to calculate your basic FIRE (Financial Independence, Retire Early) number and a baseline projection for when you might reach it.
             </p>
                </div>
                <div class="mt-2 md:mt-0">
                    <label class="font-semibold text-gray-700 mr-2">FIRE Mode:</label>
                    <select id="fireMode" class="border rounded px-2 py-1">
                        <option value="normal">Normal</option>
                        <option value="coast">Coast FIRE</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Events Timeline UI (now includes recurring incomes) -->
        <div class="mb-8 non-printable" id="eventsTimelineSection">
            <h3 class="input-section-title">Major Life Events, Lump Sums & Recurring Incomes</h3>
            <p class="section-explanation">Add one-time, temporary, or recurring cash flows (expenses or income) that will impact your plan. Examples: college costs, inheritance, home sale, sabbatical, pensions, rental income, Social Security, or part-time work. For recurring income, use 'Income' with a start and end age.</p>
            <div id="eventsList" class="mb-4"></div>
            <form id="addEventForm" class="flex flex-wrap gap-2 items-end">
                <select id="eventType" class="border rounded px-2 py-1">
                    <option value="expense">Expense</option>
                    <option value="income">Income</option>
                </select>
                <input type="text" id="eventDescription" placeholder="Description" class="border rounded px-2 py-1" style="min-width:120px;">
                <input type="number" id="eventAmount" placeholder="Amount (per year)" class="border rounded px-2 py-1" style="width:100px;">
                <input type="number" id="eventStartAge" placeholder="Start Age" class="border rounded px-2 py-1" style="width:80px;">
                <input type="number" id="eventEndAge" placeholder="End Age (optional)" class="border rounded px-2 py-1" style="width:120px;">
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded">Add Event</button>
            </form>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 non-printable">
            <!-- Input Column 1: Current Situation -->
            <div>
                <h3 class="input-section-title">Current Situation</h3>
                <div class="input-group"><label for="currentAge">Current Age</label><input type="number" id="currentAge" value="30" step="1"></div>
                <div class="input-group"><label for="currentSavings">Current Savings Balance</label><input type="number" id="currentSavings" value="50000" step="1000"></div>
                <div class="input-group"><label for="grossAnnualIncome">Gross Annual Income</label><input type="number" id="grossAnnualIncome" value="70000" step="1000"></div>
                <div class="input-group">
                    <label for="yearlySavingsContribution">
                        Net Yearly Savings Contribution
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext">Enter the total amount of money you add to your savings and investments each year, after taxes. This includes contributions to retirement accounts (like 401k, IRA) and brokerage accounts.</span>
                        </span>
                    </label>
                    <input type="number" id="yearlySavingsContribution" value="15000" step="500">
                </div>            </div>
            <!-- Input Column 2: Retirement Goals -->
            <div>
                <h3 class="input-section-title">Retirement Goals</h3>


                <div class="input-group">
                    <label for="yearlyExpensesInRetirement">
                        Desired Yearly Expenses in Retirement (in selected currency)
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext">Estimate your total annual spending in retirement in today's money. Be realistic and comprehensive, including housing, travel, healthcare, and hobbies. This is one of the most important numbers for your calculation.</span>
                        </span>
                    </label>
                    <input type="number" id="yearlyExpensesInRetirement" value="40000" step="1000">
                </div>                
                <div class="input-group">
                    <label for="monthlyIncomeAfterFIRE">
                        Monthly Income After FIRE (in selected currency)
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext">Enter any reliable, ongoing income you expect to receive in retirement (e.g., from a pension, rental property, or part-time work). This income reduces the amount you'll need to withdraw from your savings.</span>
                        </span>
                    </label>
                    <input type="number" id="monthlyIncomeAfterFIRE" value="0" step="100">
                </div>                <div class="input-group"><label for="withdrawalRate">
                    Safe Withdrawal Rate (%)
                    <span class="tooltip text-gray-400 font-normal">(?)
                        <span class="tooltiptext">
                            This is the percentage of your savings you plan to withdraw each year in retirement. The "4% Rule" is a common guideline, suggesting you can safely withdraw 4% of your initial retirement portfolio, adjusting the amount for inflation each year, with a high probability of your money lasting for 30+ years. This rate directly determines your FIRE Number (Yearly Expenses ÷ Withdrawal Rate).
                        </span>
                    </span>
                </label><input type="number" id="withdrawalRate" value="4" step="0.1"></div>
            </div>
            <!-- Input Column 3: Assumptions & Scenarios -->
            <div>
                <h3 class="input-section-title">Assumptions & Scenarios</h3>
                <div class="input-group">
                    <label for="currency">Currency</label>
                    <select id="currency">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (€)</option>
                        <option value="GBP">GBP (£)</option>
                        <option value="JPY">JPY (¥)</option>
                        <option value="SGD">SGD (S$)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="preFireReturn">
                        Pre-FIRE Expected Annual Investment Return (%)
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext" style="text-align: left; padding: 0.75rem; width: 300px; margin-left: -150px;">
                                <strong>Enter the NOMINAL return (before inflation).</strong>
                                <hr class="my-2 border-gray-400">
                                The calculator subtracts your 'Expected Inflation Rate' for you. For reference, the S&P 500's historical average is about 10%. If you expect that, enter "10".
                            </span>
                    </label>
                    <input type="number" id="preFireReturn" value="7" step="0.1">
                </div>                
                <div class="input-group">
                    <label for="postFireReturn">
                        Post-FIRE Expected Annual Investment Return (%)
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext" style="text-align: left; padding: 0.75rem; width: 300px; margin-left: -150px;">
                                <strong>Enter the NOMINAL return (before inflation).</strong>
                                <hr class="my-2 border-gray-400">
                                The calculator subtracts your 'Expected Inflation Rate' for you. This return is for your 'drawdown' phase and is often more conservative than the Pre-FIRE return.
                            </span>                        </span>
                    </label>
                    <input type="number" id="postFireReturn" value="7" step="0.1">
                </div>                
                <div class="input-group">
                    <label for="expectedInflationRate">
                        Expected Annual Inflation Rate (%)
                        <span class="tooltip text-gray-400 font-normal">(?)
                            <span class="tooltiptext">Inflation is the rate at which the cost of living increases. This calculator uses it to determine the "real" return on your investments (your return after accounting for inflation). A historical average is around 3%.</span>
                        </span>
                    </label>
                    <input type="number" id="expectedInflationRate" value="3" step="0.1">
                </div>
                <div class="input-group mt-4"><label for="numMonthlyRows">Months to Detail in Pre-FIRE Table</label><input type="number" id="numMonthlyRows" value="12" min="0" max="60" step="1"></div>
            </div>
        </div>

        <div class="mt-8 text-center non-printable">
            <button id="calculateButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md">Calculate Projection</button>
            <button id="resetButton" class="ml-4 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md">Reset</button>
            <button id="exportDataButton" class="ml-4 bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md hidden">Export Data</button>
            <button id="printSummaryButton" class="ml-4 bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md hidden">Print Summary</button>
        </div>
        
        <div id="resultsSection" class="mt-10 hidden page-break">
             <!-- Main Results Cards -->
            <h2 class="text-2xl font-semibold text-blue-700 mb-2 text-center">2. Your FIRE Projection Summary</h2>
             <p class="section-explanation text-center max-w-3xl mx-auto">
                This is your baseline projection. It assumes your investment returns are the same every year. Use this as a starting point before stress-testing your plan in the Advanced Simulation section below.
             </p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="summaryCardsGrid">
                <div class="results-card"><h3>Adjusted FIRE Number</h3><p id="fireNumberResult" class="value"></p><p class="desc">Savings for expenses not covered by post-FIRE income.</p></div>
                <div class="results-card"><h3>Time to FIRE</h3><p id="timeToFIREResult" class="value"></p><p class="desc">Time to reach Adjusted FIRE Number.</p></div>
                <div class="results-card"><h3>Age at FIRE</h3><p id="ageAtFIREResult" class="value"></p><p class="desc">Your age when Adjusted FIRE Number is met.</p></div>
                <div class="results-card"><h3>FI Date</h3><p id="fiDateResult" class="value"></p><p class="desc">Calendar date of reaching Adjusted FIRE Number.</p></div>
                <div class="results-card"><h3>Savings Rate</h3><p id="savingsRateResult" class="value"></p><p class="desc">Percentage of gross income saved annually.</p></div>
                <div class="results-card"><h3>Years of Expenses Covered (Current)</h3><p id="expensesCoveredResult" class="value"></p><p class="desc">Current savings cover this many years of retirement expenses.</p></div>
                <div class="results-card"><h3>Total Contributions to FIRE</h3><p id="totalContributionsResult" class="value"></p><p class="desc">Total amount contributed until FIRE.</p></div>
                <div class="results-card"><h3>Total Growth to FIRE</h3><p id="totalGrowthResult" class="value"></p><p class="desc">Total investment gains by FIRE.</p></div>
                <div class="results-card"><h3>Savings at FIRE</h3><p id="savingsAtFIREResult" class="value"></p><p class="desc">Projected savings when FIRE is reached.</p></div>
                <div class="results-card hidden" id="coastNumberCard"><h3>Coast FIRE Number</h3><p id="coastNumberResult" class="value"></p><p class="desc">Amount needed at Coast Age to reach FIRE by Target Age with no further savings.</p></div>
            </div>
            <!-- Tabbed Projections -->
            <div class="mt-8">
                <div class="flex border-b border-gray-300 non-printable">
                    <button id="annualPreFireTabButton" class="tab-button active">Pre-FIRE (Annual)</button>
                    <button id="monthlyPreFireTabButton" class="tab-button">Pre-FIRE (Monthly Detail)</button>
                    <button id="postFireTabButton" class="tab-button">Post-FIRE Projection (Baseline)</button>
                </div>
                <div id="annualPreFireTabContent" class="tab-content"><h3 class="text-xl font-semibold text-blue-700 mb-3 mt-2">Annual Savings Growth (Pre-FIRE, Real Returns)</h3><div class="overflow-x-auto"><table id="annualProjectionTable" class="min-w-full"><thead><tr><th>Year</th><th>Age</th><th>Starting Savings</th><th>Contributions</th><th>Investment Growth (Real)</th><th>Events</th><th>Ending Savings</th></tr></thead><tbody id="annualProjectionTableBody"></tbody></table></div></div>
                <div id="monthlyPreFireTabContent" class="tab-content hidden"><h3 class="text-xl font-semibold text-blue-700 mb-3 mt-2">Detailed Monthly Growth (First <span id="detailedMonthsCount"></span> Months Pre-FIRE)</h3><div class="overflow-x-auto"><table id="monthlyProjectionTable" class="min-w-full"><thead><tr><th>Month</th><th>Date</th><th>Age</th><th>Starting Savings</th><th>Contribution</th><th>Growth (Real)</th><th>Events</th><th>Ending Savings</th></tr></thead><tbody id="monthlyProjectionTableBody"></tbody></table></div></div>
                <div id="postFireTabContent" class="tab-content hidden"><h3 class="text-xl font-semibold text-blue-700 mb-3 mt-2">Post-FIRE Annual Projection (Baseline Scenario - Real Values)</h3><p class="text-sm text-gray-600 mb-2">Based on Post-FIRE returns. Continues up to age 95 or until savings depleted.</p><div id="postFireWarningMessage" class="hidden warning-message"></div><div class="overflow-x-auto"><table id="postFireProjectionTable" class="min-w-full"><thead><tr><th>Year (Post-FIRE)</th><th>Age</th><th>Starting Savings</th><th>Growth (Real)</th><th>Net Withdrawal from Savings</th><th>Total Income Rec'd</th><th>Ending Savings</th></tr></thead><tbody id="postFireProjectionTableBody"></tbody></table></div></div>
            </div>
            <!-- What-If Levers Section -->
            <div id="whatIfLeversSection" class="mt-10 p-6 bg-slate-50 rounded-lg border border-slate-200 shadow-sm non-printable">
                <h3 class="text-xl font-semibold text-blue-700 mb-4">What-If Levers: Instantly See the Impact</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-4">
                    <div>
                        <label for="whatIfSavings" class="block font-medium text-gray-700 mb-1">Yearly Savings Contribution</label>
                        <input type="range" id="whatIfSavings" min="0" step="500" class="w-full">
                        <div class="text-sm text-gray-600 mt-1">Current: <span id="whatIfSavingsValue">15,000</span></div>
                    </div>
                    <div>
                        <label for="whatIfRetireExpenses" class="block font-medium text-gray-700 mb-1">Yearly Retirement Expenses</label>
                        <input type="range" id="whatIfRetireExpenses" min="10000" step="1000" class="w-full">
                        <div class="text-sm text-gray-600 mt-1">Current: <span id="whatIfRetireExpensesValue">40,000</span></div>
                    </div>
                    <div>
                        <label for="whatIfMonthlyIncome" class="block font-medium text-gray-700 mb-1">Monthly Income After FIRE</label>
                        <input type="range" id="whatIfMonthlyIncome" min="0" step="100" class="w-full">
                        <div class="text-sm text-gray-600 mt-1">Current: <span id="whatIfMonthlyIncomeValue">0</span></div>
                    </div>
                </div>
                <div class="flex flex-col items-center mt-4">
                    <div class="bg-white border border-blue-200 rounded-lg px-6 py-4 shadow text-center">
                        <div class="text-lg font-semibold text-blue-700" id="whatIfResultLabel">Projected FIRE Age</div>
                        <div class="text-3xl font-bold text-blue-900 mt-1" id="whatIfResultValue">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- "One More Year" Scenario Section -->
        <div id="oneMoreYearSection" class="hidden page-break">
            <h2 class="scenario-section-title text-purple-700 mb-2 text-center">3. "One More Year" Scenario Analysis</h2>
            <p class="section-explanation text-center max-w-3xl mx-auto non-printable">
               This section helps you quantify the financial benefit of working a few extra years past your projected FIRE date. See how it impacts your final portfolio value and the lifestyle it can support.
            </p>
            <div id="oneMoreYearErrorMessage" class="hidden error-message non-printable"></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 mb-6 max-w-lg mx-auto non-printable">
                <div class="input-group">
                    <label for="extraWorkingYears">Extra Working Years</label>
                    <input type="number" id="extraWorkingYears" value="1" min="0" max="20" step="1">
                </div>
                 <div class="input-group">
                    <label for="omyYearlySavingsContribution">Yearly Savings During Extra Years
                        <span class="tooltip text-gray-400">(?)<span class="tooltiptext">Defaults to primary savings if blank. Enter a new amount if your savings would change.</span></span>
                    </label>
                    <input type="number" id="omyYearlySavingsContribution" placeholder="Uses primary savings if blank" step="500">
                </div>
                 <div class="input-group flex items-end">
                    <button id="runOneMoreYearButton" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md w-full">Calculate</button>
                </div>
            </div>
            <div id="oneMoreYearResultsContainer" class="hidden mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                 <h3 class="text-xl font-semibold text-purple-700 mb-3 text-center">Impact of Working <span id="extraYearsDisplay">1</span> Extra Year(s)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="results-card bg-purple-100 border-purple-500">
                        <h3>New Portfolio Value at Retirement</h3>
                        <p id="omyPortfolioValue" class="value"></p>
                        <p class="desc">Projected total savings after extra working years.</p>
                    </div>
                    <div class="results-card bg-purple-100 border-purple-500">
                        <h3>New Retirement Age</h3>
                        <p id="omyRetirementAge" class="value"></p>
                        <p class="desc">Your age after working extra years.</p>
                    </div>
                    <div class="results-card bg-purple-100 border-purple-500">
                        <h3>Increased Yearly Spending Possible</h3>
                        <p id="omyIncreasedSpending" class="value"></p>
                        <p class="desc">If maintaining original withdrawal rate and retirement duration to age 95.</p>
                    </div>
                     <div class="results-card bg-purple-100 border-purple-500">
                        <h3>Or, Funds Last Until Age</h3>
                        <p id="omyFundsLastUntil" class="value"></p>
                        <p class="desc">If maintaining original spending level (projects up to age 95).</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Early Retirement Income Section -->
        <div id="earlyRetirementIncomeSection" class="hidden mt-12 pt-6 border-t-2 border-emerald-400">
            <h2 class="scenario-section-title text-emerald-700 mb-6 text-center">4. Potential Early Retirement Income & Capital Growth</h2>
            <p class="text-center text-gray-600 mb-4">This chart shows how different savings rates impact your accumulated capital (dashed lines, right axis) and the sustainable monthly income it could generate (solid lines, left axis).</p>
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6 mb-6 max-w-5xl mx-auto items-end non-printable">
                <div class="input-group">
                    <label for="compStartDateMonth">Plot Start Month</label>
                    <select id="compStartDateMonth">
                        <option value="0">January</option><option value="1">February</option><option value="2">March</option>
                        <option value="3">April</option><option value="4">May</option><option value="5">June</option>
                        <option value="6">July</option><option value="7">August</option><option value="8">September</option>
                        <option value="9">October</option><option value="10">November</option><option value="11">December</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="compStartDateYear">Plot Start Year</label>
                    <input type="number" id="compStartDateYear" value="2025" step="1">
                </div>
                <div class="grid grid-cols-2 gap-x-4">
                    <div class="input-group"><label for="compSavings1">Comp. Savings 1 (/yr)</label><input type="number" id="compSavings1" step="1000"></div>
                    <div class="input-group"><label for="compStartSavings1">Starting Savings</label><input type="number" id="compStartSavings1" placeholder="Uses primary" step="1000"></div>
                </div>
                <div class="grid grid-cols-2 gap-x-4">
                    <div class="input-group"><label for="compSavings2">Comp. Savings 2 (/yr)</label><input type="number" id="compSavings2" placeholder="Optional" step="1000"></div>
                    <div class="input-group"><label for="compStartSavings2">Starting Savings</label><input type="number" id="compStartSavings2" placeholder="Uses primary" step="1000"></div>
                </div>
                <div class="input-group flex items-end">
                    <button id="runEarlyRetirementPlotButton" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md w-full">Update Plot</button>
                </div>
            </div>
            <div id="earlyRetirementPlotContainer" class="mb-8 w-full max-w-4xl mx-auto bg-white p-2 rounded shadow"></div>
        </div>
        
        <!-- Advanced Retirement Simulation Section -->
        <div id="retirementSimulationSection" class="hidden page-break">
            <h2 class="scenario-section-title text-indigo-700 mb-2 text-center">5. Advanced Retirement Simulation</h2>
            <p class="section-explanation text-center max-w-4xl mx-auto">
                This is the most important step for stress-testing your plan. While the baseline projection assumes constant returns every year, this section simulates real-world uncertainty.<br><br>
                <b>Historical Cycles (The "Reality Check"):</b> This method tests your plan against the actual, recorded market history. It answers the question: "How would my plan have survived the best and worst periods of the last century?" Its strength is using real-world data, including every major crash and boom exactly as they happened.<br><br>
                <b>Monte Carlo (The "What-If Engine"):</b> This method is a powerful futuristic tool. Instead of replaying the past, it generates thousands of unique, random futures based on *your* assumptions for average returns and market volatility. It answers the question: "If the future is as good or bad as I expect, what are my chances of success?" Its strength is its flexibility to model scenarios that haven't occurred in the past. The results are a direct reflection of the parameters you set.
            </p>
            <div id="simulationErrorMessage" class="hidden error-message non-printable"></div>
            
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner mb-8 non-printable">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 items-start">
                    <!-- Column 1: Simulation Type and Core Inputs -->
                    <div>
                        <div class="input-group">
                             <label class="font-semibold text-gray-700">1. Select Simulation Type</label>
                             <div class="mt-2 flex space-x-4">
                                <div>
                                    <input type="radio" name="simType" id="simTypeMonteCarlo" value="monteCarlo" class="hidden">
                                    <label for="simTypeMonteCarlo" class="radio-label">Monte Carlo</label>
                                </div>
                                <div>
                                    <input type="radio" name="simType" id="simTypeHistorical" value="historical" class="hidden" checked>
                                    <label for="simTypeHistorical" class="radio-label">Historical Cycles</label>
                                </div>
                            </div>
                        </div>
                        <div class="input-group mt-6">
                            <label for="simPortfolioValue" class="font-semibold text-gray-700">2. Retirement Portfolio</label>
                            <input type="number" id="simPortfolioValue" step="1000">
                        </div>
                         <div class="input-group">
                            <label for="simYearlyExpenses" class="font-semibold text-gray-700">3. Yearly Expenses in Retirement</label>
                            <input type="number" id="simYearlyExpenses" step="1000">
                        </div>
                        <div class="input-group">
                            <label for="simRetirementAge" class="font-semibold text-gray-700">4. Retirement Age</label>
                            <input type="number" id="simRetirementAge" step="1">
                        </div>
                    </div>
                    <!-- Column 2: Parameters -->
                    <div>
                        <div id="monteCarloParams" class="hidden">
                             <label class="font-semibold text-gray-700">Monte Carlo Parameters</label>
                             <div class="space-y-4 mt-2">
                                <div class="input-group">
                                    <label for="simReturn">Avg. Annual Return (%)</label>
                                    <input type="number" id="simReturn" value="7" step="0.5">
                                </div>
                                <div class="input-group">
                                    <label for="simVolatility">Market Volatility (Std. Dev %)</label>
                                    <input type="number" id="simVolatility" value="15" step="0.5">
                                </div>
                                 <div class="input-group">
                                    <label>Parameter Presets</label>
                                    <div class="flex flex-wrap gap-2 mt-1">
                                        <button class="preset-button" data-return="5" data-vol="10">Conservative</button>
                                        <button class="preset-button" data-return="7" data-vol="15">Balanced</button>
                                        <button class="preset-button" data-return="9" data-vol="20">Aggressive</button>
                                    </div>
                                </div>
                                 <div class="input-group">
                                    <label for="simCount">Number of Simulations</label>
                                    <input type="number" id="simCount" value="1000" step="100">
                                </div>
                            </div>
                        </div>
                        <div id="historicalParams">
                             <label class="font-semibold text-gray-700">Historical Parameters</label>
                             <div class="input-group mt-2">
                                <label for="stockAllocation">
                                    Stock / Bond Allocation (%)
                                    <span class="tooltip text-gray-400 font-normal">(?)
                                        <span class="tooltiptext">This determines the mix of stocks and bonds in your portfolio. Historically, stocks offer higher returns but come with more volatility (risk), while bonds are more stable but have lower returns. A common mix is 60% stocks / 40% bonds.</span>
                                    </span>
                                </label>                                 <div class="flex items-center gap-2">
                                     <span class="text-sm">Stocks</span>
                                     <input type="range" id="stockAllocation" min="0" max="100" value="60" step="5" class="w-full">
                                     <span class="text-sm">Bonds</span>
                                 </div>
                                 <div class="text-center font-medium mt-1"><span id="stockAllocationValue">60</span>% / <span id="bondAllocationValue">40</span>%</div>
                             </div>
                             <p class="text-sm text-gray-600">Based on S&P 500 & 10-Yr Treasury data from 1928-2023.</p>
                        </div>
                    </div>
                </div>
                 <!-- Row 2: Spending Flexibility -->
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <label class="font-semibold text-gray-700">5. Spending Flexibility (Optional)</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 mt-2">
                         <div class="input-group">
                            <label for="flexThreshold">Reduce spending if portfolio drops below initial value by:</label>
                            <input type="number" id="flexThreshold" value="20" step="5">
                        </div>
                         <div class="input-group">
                            <label for="flexReduction">Spending Reduction Amount (%):</label>
                            <input type="number" id="flexReduction" value="10" step="5">
                        </div>
                    </div>
                     <p class="text-xs text-gray-500">This rule reduces your spending temporarily when your portfolio is down, helping it recover faster. Spending reverts to normal once the portfolio returns to its initial value.</p>
                </div>
            </div>

            <div class="text-center mb-8 non-printable"><button id="runSimulationButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md">Run Simulation</button></div>
            
            <div id="simulationResultsContainer" class="hidden">
                 <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
                    <div class="sim-results-card"><h3>Success Rate</h3><p id="simSuccessRate" class="value"></p><p class="desc">Chance of portfolio lasting to age 95.</p></div>
                    <div class="sim-results-card"><h3>Median Final Value</h3><p id="simMedian" class="value"></p><p class="desc">50th percentile portfolio value at age 95.</p></div>
                    <div class="sim-results-card"><h3>10th Percentile Value</h3><p id="sim10thPercentile" class="value"></p><p class="desc">A "bad outcome" scenario at age 95.</p></div>
                    <div class="sim-results-card"><h3>90th Percentile Value</h3><p id="sim90thPercentile" class="value"></p><p class="desc">A "good outcome" scenario at age 95.</p></div>
                    <div class="sim-results-card"><h3>Years w/ Reduced Spending</h3><p id="simFlexYears" class="value"></p><p class="desc">Median number of years spending was cut.</p></div>
                </div>
            </div>
            <div id="simulationPlotContainer" class="mb-8 w-full max-w-4xl mx-auto bg-white p-2 rounded shadow"></div> 
            <div id="simulationWarning" class="text-center text-amber-700 mt-4 hidden"></div>
        </div>

        <!-- Modal for Export Data -->
        <div id="exportModal" class="modal hidden non-printable">
            <div class="modal-content">
                <span id="closeExportModal" class="close-button">&times;</span>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">FIRE Calculator Summary</h3>
                <textarea id="exportDataTextArea" readonly class="p-2 border border-gray-300 rounded-md"></textarea>
                <button id="copyExportDataButton" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md">Copy to Clipboard</button>
            </div>
        </div>


        <footer class="mt-12 pt-6 border-t border-gray-300 text-center text-sm text-gray-500">
            <p>&copy; <span id="currentYear"></span> The FI Calculator.  This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer" class="underline hover:text-blue-500">CC BY-NC-SA 4.0 License</a>
                <a href="https://github.com/your-username/advanced-fire-calculator" target="_blank" rel="noopener noreferrer" class="ml-4 underline hover:text-blue-500">View on GitHub</a>
            </p>
            <p class="non-printable text-xs max-w-3xl mx-auto mt-2">
                <b>Disclaimer:</b> This tool is for informational and illustrative purposes only and does not constitute financial, investment, or tax advice. The projections are based on the assumptions you provide and do not guarantee future results. All financial decisions should be made with the guidance of a qualified professional.
            </p>
        </footer>


        <div class="mt-8 pt-6 border-t border-gray-200 text-center non-printable">
            <p class="text-sm text-gray-600 mb-2">If you found this calculator helpful, consider supporting its development:</p>
            <a href='https://ko-fi.com/Z8Z41GFY8V' target='_blank' class='inline-block'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi6.png?v=6' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>
             
        </div>
        
    </div>


    <button id="feedbackButton" title="Submit Feedback" class="non-printable fixed bottom-5 right-5 bg-blue-600 hover:bg-blue-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center z-40">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
        </svg>
    </button>
    
    <div id="feedbackModal" class="modal hidden non-printable">
        <div class="modal-content">
            <span id="closeFeedbackModal" class="close-button">&times;</span>
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Submit Feedback</h3>
            <p class="text-sm text-gray-600 mb-4">Have a suggestion or found a bug? I'd love to hear from you!</p>
            
            <form id="feedbackForm" action="https://formspree.io/f/xeokgnpe" method="POST">
                <div class="input-group">
                    <label for="feedbackType">Type of Feedback</label>
                    <select id="feedbackType" name="feedbackType" required>
                        <option value="Suggestion">Suggestion / Idea</option>
                        <option value="Bug_Report">Bug Report</option>
                        <option value="General_Comment">General Comment</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="feedbackMessage">Message</label>
                    <textarea id="feedbackMessage" name="message" rows="5" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Please be as detailed as possible." required></textarea>
                </div>
                <div class="input-group">
                     <label for="feedbackEmail">Your Email (Optional)</label>
                     <input type="email" id="feedbackEmail" name="email" placeholder="In case I need to follow up.">
                </div>
                <div class="mt-6 text-right">
                    <button id="feedbackSubmitButton" type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg shadow-md">Submit</button>
                </div>
            </form>
            <div id="feedbackThanks" class="hidden text-center p-8">
                <h3 class="text-xl font-semibold text-green-600">Thank You!</h3>
                <p>Your feedback has been submitted successfully.</p>
            </div>
        </div>
    </div>
</body>
</html>